# 論文TODO（未着手作業リスト / 優先度つき）

作成日: 2026-02-07
対象: CSS論文「3段カスケード型フィッシング検出における投入制御とルール統合の効果分析」

---

## 優先度0（即死回避：整合性・再現性の破綻を先に潰す）

### TODO-0: 図（images）と data の数値整合を100%一致させる（最優先）

**状況**: `docs/paper/images/` に旧実験の図が混入しており、本文・`docs/paper/data/`（検証済み）と数値不一致がある。これは査読で即死。

**必要な作業**:
- [ ] 論文に使う図を確定（最低限: Fig1=アーキ図, Fig2=遷移, Fig3=スイープ, Fig4=遅延, Fig5=誤り分解）
- [ ] `docs/paper/data/`（例: `tables/fig2_stage_transitions.csv` など）から **再生成**して `docs/paper/images/` を上書き
- [ ] 旧図（入力127,754 / Stage3 15,670 等の系統）を削除または `docs/paper/images/_legacy/` に隔離し、本文参照を完全に断つ
- [ ] 図キャプションに母数（n=127,222 / n=11,952 等）を明記し、本文中の引用値と一致させる

**受入条件（Done定義）**:
- [ ] `paper_outline.md` の検証済み数値と、本文・表・図の全てが一致（不一致ゼロ）

**優先度**: 最高

---

## 優先度1（MTG合意の反映：論文の芯を固定する）

### TODO-7: 「確信度（グレー）を定義して後段へ送る」設計思想を本文の主軸に固定

**目的**: 2025/12のMTG合意（`docs/mtg/202512/`：FN追跡ではなく不確実性=グレーの定義と投入制御）を、RQ/説明/議論に一貫して反映する。

**必要な作業**:
- [ ] §1（導入）に「本研究の焦点は分類器の優劣ではなく、確信度に基づく投入制御と困難集合での補正」である旨を明記
- [ ] RQ1/RQ2の書き方を「投入率（budget）と自動判定の信頼性」「困難集合でのルール統合」に寄せ、FN削減"だけ"の書き方を避ける
- [ ] §4（評価）で Stage3 の評価対象が **difficult subset (n=11,952)** であることを表題・キャプションで明確化

**優先度**: 高

---

## 優先度2（査読耐性の最低ライン：殴られないための防御線）

### TODO-8: Fig3（スイープ）の主張と図の対応を一致させる

**状況**: `tables/fig3_threshold_sweep.csv` は「投入率 vs auto_errors（Stage1+2の自動誤り）」であり、最終性能（Stage3込み）の曲線ではない。

**必要な作業（どちらかを選ぶ）**:
- [ ] **案A（追加実験なし）**: Fig3の主張を「投入率と自動判定誤り（auto_errors）の関係」に限定し、最終性能は `table3_system_performance.csv` の点比較で述べる
- [ ] **案B（最小追加実験）**: τを2〜3点選び、Stage3まで回して最終F1/FPR/FNRを算出し、Fig3を"最終性能トレードオフ"として成立させる

**優先度**: 高（案Aなら文章修正のみで軽い）

---

### TODO-9: 母数のズレ（11,952 vs 11,936）を明示し、引用の混在を禁止する

**状況**:
- Stage3全体の性能（困難集合）は `docs/paper/data/tables/table5_stage3_performance.csv`（n=11,952）
- アブレーションは `docs/paper/data/tables/table6_stage3_ablation.csv`（n=11,936。`llm_raw_output` 抽出不可16件を除外）

**必要な作業**:
- [ ] Table5とTable6のキャプションに、母数と除外理由を明記（脚注でよい）
- [ ] 本文で Stage3 の性能値を引用するとき、どちらの母数かを必ず付記（例: "on the difficult subset (n=11,952)"）
- [ ] 可能なら Table5側も 11,936 に揃えた再集計版を作り、本文の引用は揃えた方に統一（任意）

**優先度**: 高（文章修正だけでリスクを大きく下げられる）

---

## レビュー指摘からの保留事項（優先度を再定義）

### TODO-1: 同一データセットでのベースライン比較（最小構成）（指摘4）

**内容**: 同一Test 127,222件で単体モデル（例: RF / LightGBM / LRのうち2〜3）を評価し、**論点を「分類器優劣」にずらされないための防御線**を作る（勝つためではない）。

**必要な作業（最小構成）**:
- [ ] 追加するモデルは **2本**（多くて3本）に限定（例: LightGBM + RF、または LightGBM + LR）
- [ ] 同一特徴量（42個）・同一分割（Train 508,888 / Test 127,222）で実施
- [ ] 最低限のチューニング（過剰探索は禁止）
- [ ] 指標は **F1/FPR/FNR（＋混同行列）** に絞る（紙面節約）
- [ ] 出力は **Appendix表** を原則とし、本文は1行で触れる（本文に表を増やさない）

**判断ポイント**: 本文で「多段設計の必然性」を強く主張するほど、ベースラインは"殴られないため"に必要度が上がる。

**優先度**: 中〜高（本文1行＋Appendix表なら紙面コストほぼゼロ）

---

### TODO-2: 「なぜ証明書か」の動機付け（最小でよい）（指摘8）

**内容**: URLやコンテンツベースの既存手法と差別化するため、証明書ベース検出の利点（早期検出、ページ取得不要、CT監視との接続可能性）を論文内で明確にする。

**判断ポイント**:
- §1.1（背景）に1〜2文で書くか
- §2（関連研究）の末尾で差別化として書くか
- §5（議論）で優位性として議論するか
- 複数箇所に分散させるか

**優先度**: 中（1〜2文で済むが、無いと読者が迷う）

---

### TODO-3: Threats to Validityの緩和策の具体化（MTG合意を反映）（指摘9）

**内容**: §5.3に列挙した脅威（観測バイアス、時間差、ラベルノイズ、ルール閾値調整）に対して、具体的な緩和策を記述する。

**判断ポイント**: 緩和策として記述できるのは実際に実施した分析のみ。以下の実験実施状況に依存する。
- 閾値感度分析 → 実施すれば「ルール閾値の調整」の緩和策になる
- 時系列評価 → 実施すれば「時間差」の緩和策になる
- 外部データ検証 → 実施すれば「観測バイアス」の緩和策になる

未実施の場合は「今後の課題」として§5または§6で言及する。

**優先度**: 高（追加実験がなくても、既存データで書ける緩和策は書く）

---

## 追加実験・データ準備

### ~~TODO-4: Stage3アブレーション実験（LLMのみ vs LLM+ルール）~~ ✅完了

**完了日**: 2026-02-07
**成果物**: `docs/paper/data/tables/table6_stage3_ablation.csv`
- `graph_state_slim_json` → `decision_trace[0].policy_trace` の `llm_raw_output` から抽出（11,936/11,952件）
- LLM単体: P=87.69%, R=55.47%, F1=67.96%
- LLM+Rules: P=76.14%, R=68.96%, F1=72.38%
- 判定変更: 806件（6.75%）、flip精度49.5%

---

### ~~TODO-5: 誤り分析（残存FN/増加FPのカテゴリ分類）~~ ✅完了

**完了日**: 2026-02-07
**成果物**: `docs/paper/data/tables/fig5_error_categories.csv`
- FN Stage別: Stage1=3, Stage2=395, Stage3=759, 合計=1,157
- FP Stage別: Stage1=2, Stage2=1, Stage3=532, 合計=535
- Stage3 FN/FPのMLスコア統計、ソース別・TLD別分布を含む

---

### ~~TODO-6: 論文データ生成スクリプト~~ ✅完了

**完了日**: 2026-02-07
**成果物**: `scripts/generate_paper_data.py`
- 表1〜6のCSV、図2〜5の元データCSV、統計JSON 5件を生成（計16ファイル）
- 出力先: `docs/paper/data/{tables,statistics}/`
- 検証済み数値リファレンスとの自動整合チェック付き

---

## 判断待ち事項（更新）

| 項目 | 判断内容 | 依存先 |
|------|---------|--------|
| TODO-0 | 旧図の扱い（削除 or legacy隔離）と再生成の方法 | `generate_paper_data.py` / 図生成スクリプト |
| TODO-7 | MTG合意（グレー定義・投入制御）をどこまで本文主張に寄せるか（RQ/Abstract/Conclusionのトーン） | `docs/mtg/202512/` / `paper_outline.md` |
| TODO-8 | Fig3を案A（追加なし）/案B（最小追加）どちらで成立させるか | 追加計算コストと主張の強さ |
| TODO-9 | 11,952/11,936 を表5/表6で統一するか（統一しない場合は脚注で明示） | `docs/paper/data/tables/table5_stage3_performance.csv` / `docs/paper/data/tables/table6_stage3_ablation.csv` |
| TODO-1 | Appendixに置くモデル数（2 or 3） | 実装負荷と紙面 |
| TODO-2 | どのセクションに書くか | 論文全体の流れを見て判断 |
| TODO-3 | 緩和策として何を書けるか（実施済みの範囲で） | TODO-4,5完了済み。Fig3/処理時間/誤り分解を活用 |
