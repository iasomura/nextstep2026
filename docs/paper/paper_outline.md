# 論文骨子: 3段カスケード型フィッシング検出システム

**作成日**: 2026-02-06
**前論文**: CSS2025「機械学習とAIエージェントを組み合わせたハイブリッド型フィッシングサイト検出システムの開発と評価」

---

## CSS2025 → 新論文の進化ポイント

| 観点 | CSS2025 | 新論文 |
|------|---------|------|
| アーキテクチャ | 2段階（ML → AI Agent） | **3段階（ML → Gate/Rule → AI Agent + Rule Engine）** |
| データ規模 | 640,356件 | 127,754件（バランスデータ、全件評価） |
| Stage2 | なし | **証明書ドメイン知識に基づくフィルタリング（新規）** |
| AI Agent | LLM単体判定 | **LLM + ドメイン知識ルール統合（新規）** |
| FNR | 6.58% → 1.04% | 5.11% → 2.32%（全件実測） |
| 偽陰性分析 | 記述的（3事例） | **体系的（ルール発火統計、検知パターン分類）** |
| 説明可能性 | reasoning出力のみ | **平均6.5個のリスク要因 + ルール発火トレース** |
| ルール設計 | インライン実装 | **モジュール化（テスト可能、個別有効/無効化）** |

---

## タイトル案

**日本語**:
「3段カスケード型ハイブリッドフィッシング検出システムにおけるルールエンジン統合の効果分析」

**英語**:
"Effect Analysis of Rule Engine Integration in a Three-Stage Cascade Hybrid Phishing Detection System"

**代替案**:
- 「証明書特徴に基づく3段カスケード型フィッシング検出における偽陰性の体系的分析」
- 「機械学習モデルの判定境界域における AI エージェントとルールエンジンの相補的検出効果」
- "Systematic Analysis of False Negatives in Three-Stage Cascade Phishing Detection Using Certificate Features"

---

## 論文構成

### 1. はじめに

**動機・背景**:
- フィッシング被害の深刻化（年間86.9億円、2024年報告件数171.8万件）
- SSL/TLS普及（HTTPS 83%以上）により従来手法の限界
- CSS2025で2段階ハイブリッドを提案、FNR 6.58%→1.04%を達成

**CSS2025の残課題**（本論文の出発点）:
- (1) Stage2フィルタがなく、全handoff候補にLLM処理 → 計算コスト課題
- (2) AI Agentの判定がLLM単体に依存 → 一貫性・再現性の課題
- (3) 偽陰性の原因分析が記述的で体系性に欠ける
- (4) 「高確信度で間違える」ケース（ML高スコアFP）への対策なし

**本論文の貢献**:
1. **Stage2（Gate/ルール層）の新設**: 証明書の業界標準知識（認証局階層、証明書種別等）に基づくフィルタにより、LLM処理を全体の9.4%に圧縮
2. **ドメイン知識ルールの統合**: LLM判定を証明書分野の専門知識で補完・修正する仕組みを実現
3. **偽陰性の体系的分析**: MLスコア領域別・検知パターン別の定量分析により、各Stageの役割と限界を明示
4. **説明可能な判定**: 各判定に対しリスク要因とルール適用根拠を付与

**論文構成の案内**:
第2章で関連研究、第3章で提案手法、第4章で評価実験、第5章で議論、第6章でまとめ

---

### 2. 関連研究

**2.1 機械学習によるフィッシング検出**
- URL/ドメイン特徴量によるML検出の発展（Sahingoz [3], Alshingiti [5]）
- 証明書特徴量の活用（"Unmasking phishers" [10], "An effective detection" [12]）
- XGBoostの有効性（[4], [15]）
- 共通課題: ブラックボックス性、偽陰性の原因分析不足

**2.2 LLMによるフィッシング検出**
- 大型LLM: GPT-4V (Koide [2]), Fine-tuning (Liu [6])
- 小型LLM: Qwen-2.5-1.5B [Improving Small LLMs], 21モデルベンチマーク [MDPI]
- 共通課題: 計算コスト、全件LLM処理の非効率性

**2.3 マルチエージェント型検出**（★新規追加セクション）
- PhishDebate: 4専門エージェント + Debate → F1 94.14%
- MultiPhishGuard: メタデータ・本文・URL並列分析
- 共通特徴: GPT-4レベルの大型LLM前提、全件LLM処理

**2.4 ハイブリッド手法**
- ML+LLMの組み合わせ（[1], [13], [14]）
- CSS2025の2段階設計（本研究の前段）
- トリアージ（ML絞り込み→LLM精査）の効率性

**2.5 説明可能AI（XAI）によるフィッシング検出**（★新規追加セクション）
- EXPLICATE: ML検出 + SHAP/LIME + LLM変換
- 規制要求（GDPR等）による説明可能性の重要性増大
- 本研究のルールエンジンによる説明可能性との関連

**2.6 本研究の位置づけ**
- 新規性マトリクス（表）
  - 3段カスケード（他研究にない設計）
  - 小型LLM（4B量子化、ローカルGPU完結）
  - 証明書のみ（ページ取得不要→早期検知可能）
  - 証明書分野の専門知識によるLLM補完

---

### 3. 提案手法

**3.1 全体設計**
- 3段カスケードアーキテクチャ（図: CSS2025の図1を拡張）
  ```
  Stage1: XGBoost → 高速スクリーニング
  Stage2: Gate/Rule → 高確信度救済 + 効率化フィルタ
  Stage3: LLM + Rule Engine → 境界域精査
  ```
- CSS2025からの変更点を明示（2段→3段、ルールエンジン追加）
- 設計原則: 「容易なケースは高速に、困難なケースは精密に」

**3.2 Stage1: XGBoostによる高速スクリーニング**（CSS2025から継承）
- 31特徴量（ドメイン構造15個、TLS証明書5個、ブランド1個等）
  - ※CSS2025では21特徴量 → 31特徴量に拡張した点を記述
- 確信度に基づく振り分け（auto_phishing / auto_benign / handoff）
- Feature Importance分析（図）

**3.3 Stage2: 証明書ドメイン知識に基づくフィルタリング**（★新規セクション）
- **設計動機**: CSS2025の課題「高確信度誤判定」への対応
- **ルール設計の根拠**: 証明書の業界標準知識に基づく（データラベルからの逆算ではない）
  - 認証局の階層（OV/EV > DV > Free CA）は業界の信頼性指標として確立
  - TLDリスク分類は公開脅威インテリジェンス（Spamhaus等）に基づく
  - ブランド偽装パターンはCERT/CCの報告事例から抽出
- フィルタ効果: handoff候補の74%をLLM処理前に判定（計算コスト削減）
- ※ルールの詳細設計は紙面の制約から割愛し、概念レベルでの説明に留める

**3.4 Stage3: AI Agent + ルールエンジン**
- **3.4.1 AI Agentの構成**（CSS2025から拡張）
  - LangGraph + Qwen3-4B (FP8量子化)
  - 4種分析ツール（ブランド偽装、証明書解析、コンテキストリスク、短ドメイン）
  - Structured Output（is_phishing, confidence, risk_factors, reasoning）
- **3.4.2 ドメイン知識ルール（★新規）**
  - LLM判定を証明書分野の専門知識で補正するポストプロセッサ
  - 知識カテゴリ（具体的ルール名は省略、概念レベルで記述）:
    - **証明書信頼性**: 認証局種別（OV/EV vs Free DV）に基づく信頼度調整
    - **ブランド偽装**: 既知ブランドとドメイン名の類似度に基づく判定
    - **複合条件**: 上記の組み合わせによる高精度判定（例: Free CA + ブランド類似 → 高リスク）
  - モジュール化設計: 個別ルールの有効/無効化、閾値調整が可能
- **3.4.3 判定統合フロー**
  - LLM判定 → ルールエンジン適用 → 最終判定
  - ルール発火トレースによる説明可能性確保

---

### 4. 評価実験

**4.1 実験設定**
- データセット: 127,754件（Phishing 63,877 / Benign 63,877）
- データソース: JPCERT/CC、PhishTank、Tranco
- XGBoost: 5-fold交差検証、ROC-AUC 0.9889
- LLM: Qwen3-4B (FP8), vLLM推論サーバ
- 評価環境: 3GPU並列（ローカル1 + リモート2）

**4.2 Stage1: XGBoostの性能**
- 精度95.70%、FNR 5.11%（stage1_decision基準）
- 特徴量重要度分析（図: Feature Importance）
- handoff候補の分布: 60,974件（phishing 3,257 / benign 57,717）

**4.3 Stage2: フィルタリングの効果**（★新規）
- Stage3入力の圧縮効果: handoff候補の74%をフィルタ（LLM処理量の大幅削減）
- フィルタの精度: フィルタによるFNの発生率を報告
- ※個別ルールの発火統計は省略（ルール設計の過学習リスクを避けるため概要のみ記載）

**4.4 Stage3: AI Agent + ルールエンジンの性能**
- **4.4.1 Stage3単体性能**（handoff候補11,952件）
  - 混同行列（表）
  - F1 72.31%, Precision 76.01%, Recall 68.96%
- **4.4.2 検知パターン分析**（★新規）
  - Stage3が検知したPhishingの特徴を類型化（ルール名ではなくドメイン知識カテゴリで分類）:
    - 低品質証明書（Free CA / DV証明書）の検出
    - 高リスクTLDとの複合判定
    - ブランド偽装と証明書品質の不整合
  - ※個別ルールの発火統計ではなく、検知できたドメインの特徴分布として記述
- **4.4.3 Stage3のみが検知できたPhishing: 327件**（★新規の深い分析）
  - MLスコア分布: ML<0.3が54%（Stage1では原理的に検知不能）
  - 代表事例（表）
  - ルールエンジンの条件付き推論の有効性

**4.5 システム全体の性能**（★大幅拡充）
- **4.5.1 3段階システム全体**
  - F1 98.66%, Precision 99.15%, Recall 98.18%
  - 処理フロー全体像（図: 各Stageの処理件数とTP/FP/FN/TN）
- **4.5.2 Stage1+2のみ vs Stage1+2+3**（★新規比較）
  - Stage1+2: F1 97.71%
  - Stage1+2+3: F1 98.66%（+0.95pp）
  - Stage3の貢献: FN 1,686件削減、FP 532件増加（FN:FP = 1:0.32）
- **4.5.3 CSS2025からの改善**
  - Baseline（CSS2025相当）: F1 97.98% → 現在: F1 98.66%（+0.68pp）
  - FP: 1,150件 → 534件（-53.7%）
  - FN: 1,425件 → 1,160件（-18.6%）
- **4.5.4 関連研究との比較**（表）
  - 本研究 vs PhishDebate vs 21 LLMs Benchmark 等
  - ※データセットの違いに注意点を記載

---

### 5. 議論

**5.1 各Stageの役割と相補性**
- Stage1: 高速・高精度だが境界域に弱い（52%を処理）
- Stage2: 効率化 + 「高確信度誤判定」救済（38%を処理）
- Stage3: 条件付き推論で境界域を精査（9.4%を処理）
- 3段設計によるコスト効率（全件LLM処理との対比）

**5.2 ドメイン知識によるML補完の意義**（★新規）
- **MLが原理的に苦手な領域を専門知識で補完**:
  - MLスコアが低くても、証明書の品質・ブランド偽装等の専門知識で検知可能なケースが存在
  - これはMLモデルの訓練データ不足ではなく、数値特徴量では表現しにくい「文脈」の問題
- **説明可能性**: 判定根拠をリスク要因として提示可能
- **再現性**: LLM単体判定と異なり、同一条件で同一結果を保証
- **ルール設計の妥当性への注意**: ルールは証明書分野の業界知識に基づくが、閾値調整にはラベル付きデータを参照しており、データセット依存性が完全に排除されているわけではない（5.5節で詳述）

**5.3 FP/FNトレードオフの合理性**
- FN:FP = 1:0.32（1件の見逃し防止に0.32件の誤検知）
- フィッシング被害コスト >> 誤検知確認コスト
- brand_cert_high ML閾値（0.12）によるFP最適化の実例

**5.4 証明書ベース早期検知の優位性**
- ページ取得不要 → ダウン済みサイトにも適用可能
- CT Log監視によるサイト稼働前検知
- 従来研究（URL+HTML+スクリーンショット前提）との差異

**5.5 制約事項と妥当性への脅威（Threats to Validity）**
- 計算資源（GPU VRAM 24GB以上推奨）
- 処理時間（平均8.31秒/ドメイン）
- 言語依存性（ブランドキーワード辞書の多言語対応が課題）
- **ルール設計のデータセット依存性**:
  - ルールの概念設計は証明書分野の業界知識（認証局階層、TLDリスク、ブランド保護）に基づく
  - ただし、閾値パラメータ（例: MLスコアの判定境界）の調整にはラベル付きデータを参照
  - この点で、ルールの効果が当該データセットに過適合している可能性を完全に否定できない
  - 緩和策: (1) ルールの概念は外部知識ソース（Spamhaus、CERT報告等）に根拠がある (2) 閾値は保守的に設定（精度最大化ではなくFP/FNバランスを重視） (3) 今後の課題として別データセットでの交差検証を予定

**5.6 今後の課題**
- (1) Stage2フィルタのFN削減（518件→目標300件以下）
- (2) 時系列評価（ゼロデイ検出能力の検証）
- (3) 説明可能性の深化（反事実的説明の統合）
- (4) 適応的特徴量学習（ルールエンジンの知見をML再学習に反映）

---

### 6. まとめ

- CSS2025の2段階システムを3段階に拡張
- 証明書ドメイン知識に基づくStage2フィルタの新設によりLLM処理を74%削減しつつ精度維持
- ドメイン知識ルールの統合により:
  - F1 98.66%（CSS2025相当のBaseline 97.98%から+0.68pp）
  - FP 53.7%削減（1,150件→534件）
  - Stage3のみが検知可能なPhishing 327件を確認
- 偽陰性の体系的分析により、MLの構造的限界とAI Agent/ルールエンジンの相補的効果を定量的に示した

---

## 図表計画

### 図
| # | 内容 | 対応セクション |
|---|------|-------------|
| 図1 | 3段カスケードアーキテクチャ（CSS2025の図1を拡張） | 3.1 |
| 図2 | XGBoost学習曲線 | 4.2 |
| 図3 | 特徴量重要度（Feature Importance Top 15） | 4.2 |
| 図4 | 偽陰性のMLスコア分布 | 4.4.3 |
| 図5 | AI Agentの解析フロー（事例） | 3.4 or 4.4 |
| 図6 | 処理フロー全体像（各Stageの件数遷移）★新規 | 4.5.1 |
| 図7 | Stage3検知パターンの分類（Venn図 or 棒グラフ）★新規 | 4.4.2 |

### 表
| # | 内容 | 対応セクション |
|---|------|-------------|
| 表1 | XGBoostの性能指標 | 4.2 |
| 表2 | MLスコア領域別の偽陰性分布 | 4.2 |
| 表3 | Stage2フィルタ効果（圧縮率・FN率）★新規 | 4.3 |
| 表4 | Stage3混同行列 | 4.4.1 |
| 表5 | Stage3検知Phishingの特徴分布★新規 | 4.4.2 |
| 表6 | Stage3固有検知の検知パターン★新規 | 4.4.3 |
| 表7 | システム全体性能（Stage1+2 vs Stage1+2+3）★新規 | 4.5.2 |
| 表8 | CSS2025 Baselineからの改善★新規 | 4.5.3 |
| 表9 | 関連研究との性能比較 | 4.5.4 |
| 表10 | 新規性マトリクス | 2.6 |

---

## CSS2025からの再利用・拡張

### 再利用可能（加筆修正）
- 1章の背景（フィッシング被害統計）→ 最新データに更新
- 3.2 XGBoost特徴量設計 → 31特徴量に拡張を反映
- 4.1 実験設定 → データセットの変更を反映
- 4.2 Stage1評価 → 基本構造は同じ

### 新規執筆が必要
- **3.3 Stage2全体**（CSS2025に存在しない）
- **3.4.2 ドメイン知識ルール**（CSS2025に存在しない）
- **4.3 Stage2評価**（CSS2025に存在しない）
- **4.4.2 検知パターン分析**（CSS2025に存在しない）
- **4.5 システム全体性能の多角的比較**（CSS2025は2段のみ）
- **5.2 ドメイン知識によるML補完の意義**（CSS2025に存在しない）
- **5.5 ルール設計のデータセット依存性への言及**（Threats to Validity）

---

## 想定ページ数

CSSフォーマット（2段組、8ページ）を想定:

| セクション | ページ数 |
|----------|---------|
| 1. はじめに | 1.0 |
| 2. 関連研究 | 1.5 |
| 3. 提案手法 | 2.0 |
| 4. 評価実験 | 2.5 |
| 5. 議論 | 0.5 |
| 6. まとめ | 0.3 |
| 参考文献 | 0.2 |
| **合計** | **8.0** |

※ ページ数が厳しい場合の削減候補:
- 2.5 XAIセクション → 2.4に統合
- 4.5.4 関連研究比較 → 議論に移動
- 5.4 早期検知 → 簡略化

---

## 執筆順序（推奨）

1. **4章（評価実験）**: データが揃っているため最初に書ける。図表を先に作成。
2. **3章（提案手法）**: 評価で使った手法を説明する形で記述。
3. **5章（議論）**: 評価結果を踏まえた考察。
4. **2章（関連研究）**: related_work.md をベースに構成。
5. **1章（はじめに）**: 全体を書いた後に統一的に記述。
6. **6章（まとめ）**: 最後に執筆。

---

## 論文の核心メッセージ

> CSS2025で提案した2段階ハイブリッドシステムに対し、証明書分野のドメイン知識をエンコードしたフィルタ層（Stage2）とLLM後段の知識ルール層を新設した。この拡張により、LLM処理量を74%削減しながら、システム全体のF1を97.98%から98.66%に向上させた。特に、MLスコアが極めて低い（< 0.3）にもかかわらずフィッシングである事例群を、証明書品質・TLDリスク・ブランド偽装の複合的な専門知識により検知できることを示した。これは、数値特徴量に依存するML単体では原理的に検知困難な領域であり、証明書分野の専門知識がML方式の構造的限界を補完しうることを示唆する。
