# データセット概要

## 概要

本研究で使用するデータセットは、PostgreSQLデータベース `rapids_data` に格納されている。フィッシングサイトの証明書データと、正規サイトの証明書データを収集・整理したものである。

## データベース接続情報

- Host: localhost
- Port: 5432
- Database: rapids_data
- 設定ファイル: `_compat/config.json`

---

## テーブル一覧

| テーブル名 | レコード数 | 説明 |
|-----------|-----------|------|
| certificates | 532,426 | フィッシングサイト証明書（JPCERT由来ドメイン） |
| jpcert_phishing_urls | 224,032 | JPCERTフィッシングURLフィード |
| phishtank_entries | 95,857 | PhishTankフィッシングデータ |
| phishing_sites | 1,831,206 | 統合フィッシングサイト情報 |
| phishing_sites_new | 1,831,206 | phishing_sitesのコピー |
| trusted_certificates | 554,912 | 正規サイト証明書（Tranco由来） |
| phishtank_* (stats) | - | PhishTank統計テーブル群 |

---

## 主要テーブル詳細

### 1. certificates テーブル

フィッシングドメインの証明書データを格納。JPCERT URLから抽出したドメインに対して証明書を収集。

**カラム構成:**
- `id`: 主キー
- `domain`: ドメイン名
- `cert_id`: 証明書ID
- `cert_data`: 証明書データ（JSON）
- `download_date`: ダウンロード日時
- `status`: 収集ステータス
- `debug_info`: デバッグ情報

**ステータス分布:**

| ステータス | 件数 | 割合 |
|-----------|------|------|
| NOT_FOUND | 261,905 | 49.2% |
| SUCCESS | 196,392 | 36.9% |
| UNKNOWN_ERROR | 42,204 | 7.9% |
| SEARCH_ERROR | 27,242 | 5.1% |
| DOWNLOAD_ERROR | 4,683 | 0.9% |

**証明書取得成功率:** 36.9% (196,392 / 532,426)

**ダウンロード期間:** 2025-03-09 〜 2025-08-24

**TLD分布（上位）:**

| TLD | 件数 |
|-----|------|
| .org | 207,708 |
| .com | 127,804 |
| .top | 61,156 |
| .cn | 39,294 |
| .xyz | 9,843 |

---

### 2. jpcert_phishing_urls テーブル

JPCERT/CCのフィッシングURLフィードから収集したデータ。

**カラム構成:**
- `id`: 主キー
- `date`: URL報告日時
- `url`: フィッシングURL
- `domain`: ドメイン名
- `cert_id`, `cert_data`: 証明書情報
- `status`: 収集ステータス
- `is_duplicate`: 重複フラグ
- `created_at`, `updated_at`: タイムスタンプ

**ステータス分布:**

| ステータス | 件数 | 割合 |
|-----------|------|------|
| SUCCESS | 116,647 | 52.1% |
| NOT_HTTPS | 41,648 | 18.6% |
| DUPLICATE | 36,033 | 16.1% |
| NOT_FOUND | 26,997 | 12.0% |
| その他 | 2,707 | 1.2% |

**URL報告期間:** 2019-01-04 〜 2025-03-31 (約6年分)

**証明書ダウンロード期間:** 2025-06-19 〜 2025-07-12

**ユニークドメイン数:** 207,506

**重複分析:**
- ユニーク: 187,999件
- 重複: 36,033件

**TLD分布（上位）:**

| TLD | 件数 |
|-----|------|
| .com | 62,393 |
| .cn | 56,066 |
| .org | 22,868 |
| .top | 12,795 |
| .xyz | 10,392 |

---

### 3. phishtank_entries テーブル

PhishTankのverified phishing URLデータ。

**カラム構成:**
- `phish_id`: PhishTank ID
- `url`: フィッシングURL
- `ip_address`: IPアドレス
- `target`: ターゲット組織
- `verified`: 検証済みフラグ
- `online`: オンラインフラグ
- `cert_data`: 証明書データ
- その他メタデータ

**基本統計:**
- 全件verified: True
- 全件online: True
- 検証期間: 2011-02-19 〜 2025-07-02

**ユニークドメイン数:** 55,284

**証明書取得成功数:** 54,365

**証明書ダウンロード期間:** 2025-06-08 〜 2025-07-02

**ターゲット分布（上位10）:**

| ターゲット | 件数 |
|-----------|------|
| Other | 86,636 |
| Allegro | 1,579 |
| Internal Revenue Service | 1,259 |
| Facebook | 963 |
| Microsoft | 925 |
| AT&T | 740 |
| Adobe | 326 |
| Optus | 278 |
| AEON Card | 249 |
| Amazon.com | 244 |

---

### 4. trusted_certificates テーブル

正規サイトの証明書データ。Trancoランキング由来のドメインから収集。

**カラム構成:**
- `id`: 主キー
- `domain`: ドメイン名
- `cert_data`: 証明書データ（JSON）
- `issuer_name`: 発行者名
- `common_name`: コモンネーム
- `not_before`, `not_after`: 有効期間
- `san_domains`: SAN拡張ドメイン
- `status`: ステータス
- `download_date`: ダウンロード日時

**ユニークドメイン数:** 554,912

**証明書取得成功数:** 450,656

**ダウンロード期間:** 2025-04-19 〜 2025-07-21

**TLD分布（上位）:**

| TLD | 件数 |
|-----|------|
| .com | 278,061 |
| .org | 45,318 |
| .net | 19,032 |
| .jp | 10,609 |
| .io | 3,756 |
| .edu | 3,128 |
| .co | 2,928 |
| .gov | 1,902 |

**証明書発行者分布（上位10）:**

| 発行者 | 件数 |
|--------|------|
| Google Trust Services (WE1) | 160,781 |
| Let's Encrypt (R10) | 68,628 |
| Let's Encrypt (R11) | 68,301 |
| Let's Encrypt (E5) | 20,029 |
| Let's Encrypt (E6) | 20,005 |
| Sectigo RSA DV | 14,916 |
| GoDaddy G2 | 11,455 |
| Amazon RSA 2048 M03 | 9,448 |
| Amazon RSA 2048 M02 | 9,171 |
| DigiCert Global G2 | 6,077 |

---

### 5. phishing_sites テーブル

複数ソースから統合したフィッシングサイト情報。外部データベースからのインポート。

**カラム数:** 57（WHOIS、ASN、ターゲット情報等を含む）

**ユニークドメイン数:** 883,276

**データソース (src) 分布:**

| ソース | 件数 |
|--------|------|
| (空) | 1,756,008 |
| VTpassive | 53,329 |
| Certstream | 14,539 |
| Twitter | 4,836 |
| PhishHunterSANs | 1,448 |
| DNPedia | 296 |
| その他 | 750 |

**ターゲット分布（上位15）:**

| ターゲット | 件数 |
|-----------|------|
| auid (au) | 203,061 |
| mufg_card | 202,121 |
| unknown | 199,203 |
| aeon | 196,524 |
| mufg | 184,779 |
| amazon | 181,223 |
| softbank | 99,915 |
| apple | 94,649 |
| docomo | 47,570 |
| smbc_card | 41,726 |
| nta (国税庁) | 41,045 |
| aeon_card | 33,176 |
| etc | 25,939 |
| mercari | 25,669 |
| rakuten_ichiba | 24,733 |

**国別分布（上位10）:**

| 国 | 件数 |
|----|------|
| US | 900,485 |
| KR | 192,976 |
| CA | 178,983 |
| CH | 62,250 |
| JP | 56,364 |
| HK | 27,989 |
| BG | 23,438 |
| RU | 18,142 |

---

## 証明書データ可用性サマリー

| テーブル | 総レコード | cert_data保有 | 保有率 |
|----------|-----------|---------------|--------|
| certificates | 532,426 | 196,392 | 36.9% |
| jpcert_phishing_urls | 224,032 | 120,466 | 53.8% |
| phishtank_entries | 95,857 | 54,365 | 56.7% |
| trusted_certificates | 554,912 | 450,656 | 81.2% |

---

## モデル学習用データ

### フィッシング（Positive）データ

3つのソースから証明書データを持つドメインを抽出:

1. **certificates** (JPCERT由来): 196,392件
2. **jpcert_phishing_urls**: 120,466件
3. **phishtank_entries**: 54,365件

重複を除去後、約**304,000件**のフィッシングドメイン証明書データ（推定）

### 正規（Negative）データ

- **trusted_certificates** (Tranco由来): 450,656件

### データ比率

- フィッシング: 約304,000件
- 正規: 約450,656件
- 比率: 約1:1.5

---

## データの特徴

### 時間的範囲

- JPCERTフィード: 2019年1月〜2025年3月（約6年分）
- PhishTank: 2011年2月〜2025年7月（約14年分）
- 証明書収集: 2025年3月〜2025年8月

### 地理的特徴

- フィッシングサイト: 米国、韓国、カナダが上位
- 日本向けフィッシング: AUID、MUFG、AEON、SoftBank等が多数

### TLD特徴

- フィッシング: .org, .com, .top, .cn, .xyzが多い
- 正規: .com, .org, .netが主流

---

## 証明書有効期間分析

### フィッシング証明書 (N=10,000 sample)

**有効期間分布:**

| 有効期間 | 件数 | 割合 |
|----------|------|------|
| 61-100日 | 9,914 | **99.1%** |
| 181-365日 | 75 | 0.8% |
| 366-730日 | 9 | 0.1% |

**平均有効期間:** 91.4日

**発行者分布（上位5）:**

| 発行者 | 件数 |
|--------|------|
| R3 (Let's Encrypt) | 8,636 |
| R10 (Let's Encrypt) | 544 |
| R11 (Let's Encrypt) | 530 |
| WE1 (Google) | 54 |
| Let's Encrypt Authority X3 | 45 |

**発行年分布:**

| 年 | 件数 |
|----|------|
| 2021 | 1,610 |
| 2022 | 4,135 |
| 2023 | 2,097 |
| 2024 | 1,975 |
| 2025 | 113 |

### 正規サイト証明書 (N=10,000 sample)

**有効期間分布:**

| 有効期間 | 件数 | 割合 |
|----------|------|------|
| 61-100日 | 4,903 | 49.0% |
| 181-365日 | 1,447 | 14.5% |
| 366-730日 | 3,454 | **34.5%** |

**平均有効期間:** 231.8日

### 重要な発見

**証明書有効期間はフィッシング検出に有効な特徴量**

| 指標 | フィッシング | 正規 |
|------|-------------|------|
| 平均有効期間 | 91.4日 | 231.8日 |
| 90日証明書率 | 99.1% | 49.0% |
| 1年以上の証明書率 | 0.1% | 34.5% |

- フィッシングサイトは**99.1%**がLet's Encryptの90日証明書を使用
- 正規サイトは**34.5%**が1-2年の有効期間を持つ証明書を使用
- **有効期間が90日の証明書はフィッシングの可能性が高い**という特徴量として活用可能

---

## 注意事項

1. **ラベルノイズ**: フィッシングとしてラベル付けされたデータの一部は、時間経過により無害化または削除されている可能性がある

2. **証明書の時間差**: URLの報告日時と証明書のダウンロード日時に差がある場合、証明書が変更されている可能性がある

3. **重複データ**: JPCERT URLには約16%の重複が含まれる

4. **NOT_HTTPS**: JPCERT URLの約18%はHTTPS未使用のため証明書データなし

---

## ファイル

- `_compat/config.json`: データベース接続設定
- `sql/rapids_data.sql`: データベーススキーマ定義

---

## 更新履歴

- 2026-01-12: 初版作成、証明書有効期間分析を追加
