# Stage3 ベースライン FN/FP 分析レポート

**作成日**: 2026-01-28
**分析対象**: `artifacts/00-baseline/2026-01-27_f1_0.6426/`
**評価データ**: `eval_df__nALL__ts_20260127_014108.csv` (15,670件)

---

## 1. 全体サマリー

### 1.1 混同行列

| 予測 \ 実際 | Phishing | Benign |
|-------------|----------|--------|
| **Phishing** | TP: 1,840 | FP: 1,148 |
| **Benign** | FN: 899 | TN: 11,783 |

### 1.2 評価指標

| 指標 | 値 |
|------|-----|
| **F1 Score** | 0.6426 |
| **Precision** | 0.6158 |
| **Recall** | 0.6718 |
| **Accuracy** | 0.8694 |

---

## 2. データソース別分析

### 2.1 ソース別混同行列

| ソース | 件数 | TP | FN | FP | TN | F1 | Precision | Recall |
|--------|------|----|----|----|----|-----|-----------|--------|
| **certificates** | 775 | 627 | 148 | 0 | 0 | 0.894 | 1.000 | 0.809 |
| **jpcert** | 1,240 | 806 | 434 | 0 | 0 | 0.788 | 1.000 | 0.650 |
| **phishtank** | 724 | 407 | 317 | 0 | 0 | 0.720 | 1.000 | 0.562 |
| **trusted** | 12,931 | 0 | 0 | 1,148 | 11,783 | - | - | - |
| **TOTAL** | **15,670** | 1,840 | 899 | 1,148 | 11,783 | 0.643 | 0.616 | 0.672 |

### 2.2 データソースの特徴

- **certificates**: 証明書ベースで収集したフィッシングドメイン。Recall 80.9%で最も検出率が高い
- **jpcert**: JPCERTが報告したフィッシングドメイン。日本語ブランド偽装が多い。Recall 65.0%
- **phishtank**: PhishTankから収集。国際的なフィッシング。Recall 56.2%で最も検出が困難
- **trusted**: Trancoリスト等から収集した正規ドメイン。FP 1,148件が発生

---

## 3. シグナル分析

### 3.1 シグナル定義

以下の特徴量をシグナル（検出可能な手がかり）として定義:

| シグナル名 | 条件 | 説明 |
|-----------|------|------|
| `danger_tld` | TLD ∈ {top, xyz, icu, ...} | 危険なTLDを使用 |
| `high_entropy` | Shannon Entropy > 4.0 | ランダム文字列の可能性 |
| `low_vowel` | 母音率 < 0.15 | ランダム文字列の可能性 |
| `long_consonant` | 最大子音連続 >= 5 | ランダム文字列の可能性 |
| `high_ml` | ML確率 > 0.5 | Stage1で検出可能 |

### 3.2 FNのシグナル分析

**FN総数: 899件**

| シグナル | 件数 | 割合 |
|---------|------|------|
| danger_tld | 99 | 11.0% |
| high_ml | 72 | 8.0% |
| long_consonant | 56 | 6.2% |
| low_vowel | 38 | 4.2% |
| high_entropy | 7 | 0.8% |
| **シグナル無し** | **721** | **80.2%** |

#### ソース別シグナル内訳 (FN)

| ソース | FN総数 | シグナル有 | シグナル無 | 無シグナル率 |
|--------|--------|-----------|-----------|-------------|
| certificates | 148 | 24 | 124 | 83.8% |
| jpcert | 434 | 96 | 338 | 77.9% |
| phishtank | 317 | 58 | 259 | 81.7% |
| **合計** | **899** | **178** | **721** | **80.2%** |

### 3.3 FPのシグナル分析

**FP総数: 1,148件** (全てtrustedソース)

| シグナル | 件数 | 割合 |
|---------|------|------|
| low_vowel | 322 | 28.0% |
| long_consonant | 238 | 20.7% |
| danger_tld | 235 | 20.5% |
| high_ml | 200 | 17.4% |
| high_entropy | 5 | 0.4% |
| **シグナル無し** | **448** | **39.0%** |

**FPの主因**: AIがランダム文字列パターン (low_vowel, long_consonant) を過剰に検出

---

## 4. エラー全体サマリー

### 4.1 シグナル有無による分類

| カテゴリ | 件数 | シグナル有 | シグナル無 | 無シグナル率 |
|---------|------|-----------|-----------|-------------|
| FN (見逃し) | 899 | 178 (19.8%) | 721 (80.2%) | 80.2% |
| FP (誤検出) | 1,148 | 700 (61.0%) | 448 (39.0%) | 39.0% |
| **エラー合計** | **2,047** | **878 (42.9%)** | **1,169 (57.1%)** | **57.1%** |

### 4.2 改善可能性による分類

```
エラー総数: 2,047件
├── シグナル有: 878件 (42.9%) → 特徴量チューニングで改善可能
│   ├── FN: 178件 (閾値調整・ルール追加で検出可能)
│   └── FP: 700件 (閾値調整・ホワイトリストで改善可能)
│
└── シグナル無: 1,169件 (57.1%) → 外部データが必要
    ├── FN: 721件 (正規ドメインと区別困難)
    └── FP: 448件 (AIの過剰検出)
```

---

## 5. シグナル無しFNのサンプル

### 5.1 jpcert (シグナル無し: 338件)

| ドメイン | TLD | ML確率 | Entropy | 母音率 |
|---------|-----|--------|---------|--------|
| contcomexcontabilidade.com.br | br | 0.041 | 3.69 | 0.37 |
| vesinhgiare.com | com | 0.151 | 3.64 | 0.43 |
| gypsiesmc.com | com | 0.046 | 3.24 | 0.25 |
| therapyaoyama.com | com | 0.033 | 3.26 | 0.44 |
| rsacouriers.com | com | 0.036 | 3.19 | 0.43 |

### 5.2 phishtank (シグナル無し: 259件)

| ドメイン | TLD | ML確率 | Entropy | 母音率 |
|---------|-----|--------|---------|--------|
| sitemaps.allegrolokalnie.pk | pk | 0.319 | 3.66 | 0.40 |
| t9iba.app | app | 0.254 | 2.73 | 0.43 |
| cli.co | co | 0.041 | 2.25 | 0.40 |
| uni.su | su | 0.051 | 2.25 | 0.60 |
| marwawater.com | com | 0.061 | 3.04 | 0.38 |

### 5.3 certificates (シグナル無し: 124件)

| ドメイン | TLD | ML確率 | Entropy | 母音率 |
|---------|-----|--------|---------|--------|
| dizhugou.com | com | 0.151 | 3.25 | 0.45 |
| yof360.com | com | 0.455 | 3.12 | 0.33 |
| huikaiju.com | com | 0.421 | 3.25 | 0.55 |
| alsihha.com | com | 0.033 | 3.10 | 0.40 |
| dreamarry.com | com | 0.256 | 3.03 | 0.33 |

**共通点**: .com TLD、低ML確率、正常なエントロピー・母音率 → 正規ドメインと区別困難

---

## 6. 証明書特徴量分析

### 6.1 カテゴリ別証明書特徴量

| 特徴量 | FN (見逃し) | TN (正常) | TP (検出) | 傾向 |
|--------|------------|-----------|-----------|------|
| CRL有り | 66.2% | 80.7% | 30.7% | FN≒TN, TP低 |
| OCSP有り | 59.1% | 51.6% | 87.5% | FN≒TN, TP高 |
| SAN数平均 | 5.2 | 3.8 | 9.1 | FN≒TN, TP高 |
| Wildcard | 10.2% | 11.3% | 1.4% | FN≒TN, TP低 |
| Let's Encrypt | ~84% | ~82% | ~35% | FN≒TN, TP低 |

### 6.2 証明書特徴量の結論

**FN と TN は証明書特徴量がほぼ同一** → 証明書特徴量のみでは FN を TN から区別することが困難

---

## 7. 改善提案

### 7.1 短期改善 (シグナル有エラー: 878件)

| 対象 | 件数 | 改善策 |
|------|------|--------|
| FN + danger_tld | 99 | 危険TLD + 他シグナルの組み合わせでリスク強化 |
| FN + high_ml | 72 | Stage1閾値調整 or Stage2でML確率を重視 |
| FP + low_vowel | 322 | Trancoホワイトリストの活用 |
| FP + danger_tld | 235 | 正規サイトの危険TLD使用を許容 |

### 7.2 中長期改善 (シグナル無エラー: 1,169件)

| 対象 | 件数 | 改善策 |
|------|------|--------|
| FN シグナル無 | 721 | VirusTotal連携、コンテンツ解析、Phishtank API |
| FP シグナル無 | 448 | プロンプト改善、AIの保守的判定への調整 |

---

## 8. 結論

1. **エラーの57%（1,169件）はシグナル無し** - 特徴量ベースの改善だけでは限界がある
2. **FNの80%はシグナル無し** - 正規ドメインと見分けがつかないフィッシング
3. **FPの61%はシグナル有** - ランダム検出の過剰反応が主因
4. **phishtankのRecallが最低（56.2%）** - 国際的なフィッシングの検出が課題
5. **証明書特徴量はFN/TN区別に有効でない** - 外部データ連携が必要

### 次のステップ

- [ ] 改善後の評価を実施し、Before/After比較
- [ ] シグナル有エラーの閾値チューニング
- [ ] VirusTotal連携によるシグナル無FNの検出強化
