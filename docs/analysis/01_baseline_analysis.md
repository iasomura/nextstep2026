# ベースライン分析

**作成日**: 2026-01-28
**更新日**: 2026-01-30 (統合)
**分析対象**: `artifacts/00-baseline/2026-01-27_f1_0.6426/`

---

## 1. 概要

| 役割 | 名称 | F1 | FN | 用途 |
|------|------|-----|-----|------|
| **ベンチマーク** | CSS2025 Paper | 0.9845 | 639件 | 目標値 |
| **開始点** | System Baseline | 0.6426 | 899件 | チューニング基準 |

---

## 2. ベースライン定義

### 2.1 CSS2025 Paper (論文発表時の性能)

**出典**: CSS2025論文「機械学習とAIエージェントを組み合わせたハイブリッド型フィッシングサイト検出システムの開発と評価」

**データセット**: 640,356件 (テストデータ: 128,072件)

#### XGBoost単体 (第一層)

| 指標 | 値 |
|-----|-----|
| Accuracy | 95.70% |
| Precision | 97.89% |
| Recall | 93.42% |
| F1 Score | 0.9560 |
| ROC-AUC | 0.9894 |
| FPR | 2.02% |
| FNR | 6.58% |
| FN件数 | 4,215件 |

#### ハイブリッドシステム (第一層 + AI Agent)

| 指標 | 値 |
|-----|-----|
| Accuracy | 99.00% |
| Precision | 97.91% |
| Recall | 99.00% |
| F1 Score | 0.9845 |
| FNR | 1.00% |
| FN件数 | 639件 |

**AI Agent効果**: 4,215件のFNから3,576件 (84.8%) を正しく検出

---

### 2.2 System Baseline (チューニング開始時点)

**出典**: `artifacts/00-baseline/2026-01-27_f1_0.6426/`
**評価データ**: `eval_df__nALL__ts_20260127_014108.csv` (15,670件)
**評価日**: 2026-01-27

| 指標 | 値 |
|-----|-----|
| **F1 Score** | 0.6426 |
| **Precision** | 0.6158 |
| **Recall** | 0.6718 |
| **Accuracy** | 0.8694 |

#### 混同行列

| 予測 \ 実際 | Phishing | Benign | 合計 |
|-------------|----------|--------|------|
| **Phishing** | TP: 1,840 | FP: 1,148 | 2,988 |
| **Benign** | FN: 899 | TN: 11,783 | 12,682 |
| **合計** | 2,739 | 12,931 | 15,670 |

**注記**:
- CSS2025 Paperと同一データセットから、VirusTotalスクリーニング後に抽出
- ML判定確信度 < 0.5 の境界領域ドメイン (Stage2 Validation用サブセット)

---

## 3. データソース別分析

### 3.1 ソース別混同行列

| ソース | 件数 | TP | FN | FP | TN | F1 | Precision | Recall |
|--------|------|----|----|----|----|-----|-----------|--------|
| **certificates** | 775 | 627 | 148 | 0 | 0 | 0.894 | 1.000 | 0.809 |
| **jpcert** | 1,240 | 806 | 434 | 0 | 0 | 0.788 | 1.000 | 0.650 |
| **phishtank** | 724 | 407 | 317 | 0 | 0 | 0.720 | 1.000 | 0.562 |
| **trusted** | 12,931 | 0 | 0 | 1,148 | 11,783 | - | - | - |
| **TOTAL** | **15,670** | 1,840 | 899 | 1,148 | 11,783 | 0.643 | 0.616 | 0.672 |

### 3.2 データソースの特徴

- **certificates**: 証明書ベースで収集したフィッシングドメイン。Recall 80.9%で最も検出率が高い
- **jpcert**: JPCERTが報告したフィッシングドメイン。日本語ブランド偽装が多い。Recall 65.0%
- **phishtank**: PhishTankから収集。国際的なフィッシング。Recall 56.2%で最も検出が困難
- **trusted**: Trancoリスト等から収集した正規ドメイン。FP 1,148件が発生

---

## 4. シグナル分析

### 4.1 シグナル定義

以下の特徴量をシグナル（検出可能な手がかり）として定義:

| シグナル名 | 条件 | 説明 |
|-----------|------|------|
| `danger_tld` | TLD ∈ {top, xyz, icu, ...} | 危険なTLDを使用 |
| `high_entropy` | Shannon Entropy > 4.0 | ランダム文字列の可能性 |
| `low_vowel` | 母音率 < 0.15 | ランダム文字列の可能性 |
| `long_consonant` | 最大子音連続 >= 5 | ランダム文字列の可能性 |
| `high_ml` | ML確率 > 0.5 | Stage1で検出可能 |

### 4.2 FNのシグナル分析

**FN総数: 899件**

| シグナル | 件数 | 割合 |
|---------|------|------|
| danger_tld | 99 | 11.0% |
| high_ml | 72 | 8.0% |
| long_consonant | 56 | 6.2% |
| low_vowel | 38 | 4.2% |
| high_entropy | 7 | 0.8% |
| **シグナル無し** | **721** | **80.2%** |

#### ソース別シグナル内訳 (FN)

| ソース | FN総数 | シグナル有 | シグナル無 | 無シグナル率 |
|--------|--------|-----------|-----------|-------------|
| certificates | 148 | 24 | 124 | 83.8% |
| jpcert | 434 | 96 | 338 | 77.9% |
| phishtank | 317 | 58 | 259 | 81.7% |
| **合計** | **899** | **178** | **721** | **80.2%** |

### 4.3 FPのシグナル分析

**FP総数: 1,148件** (全てtrustedソース)

| シグナル | 件数 | 割合 |
|---------|------|------|
| low_vowel | 322 | 28.0% |
| long_consonant | 238 | 20.7% |
| danger_tld | 235 | 20.5% |
| high_ml | 200 | 17.4% |
| high_entropy | 5 | 0.4% |
| **シグナル無し** | **448** | **39.0%** |

**FPの主因**: AIがランダム文字列パターン (low_vowel, long_consonant) を過剰に検出

---

## 5. エラー全体サマリー

### 5.1 シグナル有無による分類

| カテゴリ | 件数 | シグナル有 | シグナル無 | 無シグナル率 |
|---------|------|-----------|-----------|-------------|
| FN (見逃し) | 899 | 178 (19.8%) | 721 (80.2%) | 80.2% |
| FP (誤検出) | 1,148 | 700 (61.0%) | 448 (39.0%) | 39.0% |
| **エラー合計** | **2,047** | **878 (42.9%)** | **1,169 (57.1%)** | **57.1%** |

### 5.2 改善可能性による分類

```
エラー総数: 2,047件
├── シグナル有: 878件 (42.9%) → 特徴量チューニングで改善可能
│   ├── FN: 178件 (閾値調整・ルール追加で検出可能)
│   └── FP: 700件 (閾値調整・ホワイトリストで改善可能)
│
└── シグナル無: 1,169件 (57.1%) → 外部データが必要
    ├── FN: 721件 (正規ドメインと区別困難)
    └── FP: 448件 (AIの過剰検出)
```

---

## 6. シグナル無しFNのサンプル

### 6.1 jpcert (シグナル無し: 338件)

| ドメイン | TLD | ML確率 | Entropy | 母音率 |
|---------|-----|--------|---------|--------|
| contcomexcontabilidade.com.br | br | 0.041 | 3.69 | 0.37 |
| vesinhgiare.com | com | 0.151 | 3.64 | 0.43 |
| gypsiesmc.com | com | 0.046 | 3.24 | 0.25 |
| therapyaoyama.com | com | 0.033 | 3.26 | 0.44 |
| rsacouriers.com | com | 0.036 | 3.19 | 0.43 |

### 6.2 phishtank (シグナル無し: 259件)

| ドメイン | TLD | ML確率 | Entropy | 母音率 |
|---------|-----|--------|---------|--------|
| sitemaps.allegrolokalnie.pk | pk | 0.319 | 3.66 | 0.40 |
| t9iba.app | app | 0.254 | 2.73 | 0.43 |
| cli.co | co | 0.041 | 2.25 | 0.40 |
| uni.su | su | 0.051 | 2.25 | 0.60 |
| marwawater.com | com | 0.061 | 3.04 | 0.38 |

**共通点**: .com TLD、低ML確率、正常なエントロピー・母音率 → 正規ドメインと区別困難

---

## 7. 証明書特徴量分析

### 7.1 カテゴリ別証明書特徴量

| 特徴量 | FN (見逃し) | TN (正常) | TP (検出) | 傾向 |
|--------|------------|-----------|-----------|------|
| CRL有り | 66.2% | 80.7% | 30.7% | FN≒TN, TP低 |
| OCSP有り | 59.1% | 51.6% | 87.5% | FN≒TN, TP高 |
| SAN数平均 | 5.2 | 3.8 | 9.1 | FN≒TN, TP高 |
| Wildcard | 10.2% | 11.3% | 1.4% | FN≒TN, TP低 |
| Let's Encrypt | ~84% | ~82% | ~35% | FN≒TN, TP低 |

### 7.2 証明書特徴量の結論

**FN と TN は証明書特徴量がほぼ同一** → 証明書特徴量のみでは FN を TN から区別することが困難

---

## 8. チューニング履歴

### 8.1 評価履歴サマリ

| 日付 | バージョン | F1 | Precision | Recall | FP | FN | 主な変更 |
|------|-----------|-----|-----------|--------|-----|-----|---------|
| 2026-01-27 | Baseline | 0.6426 | 0.6158 | 0.6718 | 1,148 | 899 | 初期状態 |
| 2026-01-28 | v1.0 | 0.680 | 0.706 | 0.661 | 747 | 942 | ロールバック実施 |
| 2026-01-29 | v1.1 | 0.709 | 0.732 | 0.687 | 741 | 924 | typical_cert削除 |
| 2026-01-30 | v1.2 | 0.709* | 0.732* | 0.687* | 142* | 177* | ml_paradox TLD条件 |

*v1.2は3000件サンプル評価

### 8.2 詳細チューニング履歴

#### 2026-01-28: ロールバックと初期改善

- random_pattern (低母音比率検出) 無効化
- digit_mixed_random 無効化
- no_vowel_dangerous_tld 無効化
- ブランドFP対策 (citi, swift, meta, hermes, appstore)

#### 2026-01-29: typical_phishing_cert_pattern修正

- `_strong_cert`から`typical_phishing_cert_pattern`を削除
- Precision 39.4%で識別力不足と判断
- F1 +2.9pp改善

#### 2026-01-30: ml_paradox TLD条件追加

- non-dangerous TLDでのml_paradox発火を抑制
- 期待効果: FP -40件, F1 +0.74pp

---

## 9. 結論

1. **エラーの57%（1,169件）はシグナル無し** - 特徴量ベースの改善だけでは限界がある
2. **FNの80%はシグナル無し** - 正規ドメインと見分けがつかないフィッシング
3. **FPの61%はシグナル有** - ランダム検出の過剰反応が主因
4. **phishtankのRecallが最低（56.2%）** - 国際的なフィッシングの検出が課題
5. **証明書特徴量はFN/TN区別に有効でない** - 外部データ連携が必要

---

## 変更履歴

- 2026-01-30: baseline_comparison.md と baseline_fnfp_analysis_20260128.md を統合
- 2026-01-28: 初版作成
